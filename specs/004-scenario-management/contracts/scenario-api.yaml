openapi: 3.0.3
info:
  title: Scenario Management API
  description: REST API for managing mock server test scenarios
  version: 1.0.0
  contact:
    name: node-mock-server
    url: https://github.com/paultaku/node-mock-server

servers:
  - url: http://localhost:3001/_mock
    description: Local development server

tags:
  - name: Scenarios
    description: Scenario CRUD operations
  - name: Active Scenario
    description: Active scenario tracking

paths:
  /scenarios:
    get:
      summary: List all scenarios
      description: Retrieve a list of all saved scenarios with their configurations
      operationId: listScenarios
      tags:
        - Scenarios
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: object
                required:
                  - scenarios
                  - activeScenario
                properties:
                  scenarios:
                    type: array
                    items:
                      $ref: '#/components/schemas/Scenario'
                  activeScenario:
                    type: string
                    nullable: true
                    description: Name of currently active scenario or null
              examples:
                multiple-scenarios:
                  summary: Multiple scenarios with one active
                  value:
                    scenarios:
                      - name: testing
                        endpointConfigurations:
                          - path: /pet/status
                            method: GET
                            selectedMockFile: success-200.json
                            delayMillisecond: 1000
                        metadata:
                          createdAt: '2025-11-29T10:00:00.000Z'
                          lastModified: '2025-11-29T10:15:00.000Z'
                          version: 2
                      - name: error-scenarios
                        endpointConfigurations:
                          - path: /pet/findByTag/{tag}
                            method: GET
                            selectedMockFile: error-404.json
                            delayMillisecond: 0
                        metadata:
                          createdAt: '2025-11-29T09:00:00.000Z'
                          lastModified: '2025-11-29T09:00:00.000Z'
                          version: 1
                    activeScenario: testing
                empty-list:
                  summary: No scenarios
                  value:
                    scenarios: []
                    activeScenario: null
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    post:
      summary: Create new scenario
      description: Create and save a new scenario with endpoint configurations
      operationId: createScenario
      tags:
        - Scenarios
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateScenarioRequest'
            examples:
              single-endpoint:
                summary: Scenario with single endpoint
                value:
                  name: quick-test
                  endpointConfigurations:
                    - path: /pet/status
                      method: GET
                      selectedMockFile: success-200.json
                      delayMillisecond: 0
              multiple-endpoints:
                summary: Scenario with multiple endpoints
                value:
                  name: full-test-suite
                  endpointConfigurations:
                    - path: /pet/status
                      method: GET
                      selectedMockFile: success-200.json
                      delayMillisecond: 1000
                    - path: /pet/findByTag/{tag}
                      method: GET
                      selectedMockFile: successful-operation-200.json
                      delayMillisecond: 500
                    - path: /user/login
                      method: POST
                      selectedMockFile: invalid-credentials-401.json
                      delayMillisecond: 2000
      responses:
        '201':
          description: Scenario created successfully
          content:
            application/json:
              schema:
                type: object
                required:
                  - scenario
                  - message
                properties:
                  scenario:
                    $ref: '#/components/schemas/Scenario'
                  message:
                    type: string
                    example: Scenario 'testing' created and activated successfully
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
              examples:
                empty-name:
                  summary: Empty scenario name
                  value:
                    error: Validation failed
                    field: name
                    constraint: Scenario name is required
                duplicate-endpoints:
                  summary: Duplicate endpoint configurations
                  value:
                    error: Validation failed
                    field: endpointConfigurations
                    constraint: Duplicate endpoint configurations detected
                empty-configurations:
                  summary: No endpoint configurations
                  value:
                    error: Validation failed
                    field: endpointConfigurations
                    constraint: Scenario must contain at least one endpoint configuration
        '409':
          description: Scenario with this name already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Scenario with name 'testing' already exists
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /scenarios/{name}:
    parameters:
      - name: name
        in: path
        required: true
        description: Scenario name
        schema:
          type: string
          pattern: '^[a-zA-Z0-9-]+$'
        example: testing

    get:
      summary: Get scenario by name
      description: Retrieve a specific scenario with all its configurations
      operationId: getScenario
      tags:
        - Scenarios
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Scenario'
        '404':
          description: Scenario not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Scenario 'testing' not found
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    put:
      summary: Update existing scenario
      description: Update a scenario's endpoint configurations
      operationId: updateScenario
      tags:
        - Scenarios
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateScenarioRequest'
      responses:
        '200':
          description: Scenario updated successfully
          content:
            application/json:
              schema:
                type: object
                required:
                  - scenario
                  - message
                properties:
                  scenario:
                    $ref: '#/components/schemas/Scenario'
                  message:
                    type: string
                    example: Scenario 'testing' updated and activated successfully
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        '404':
          description: Scenario not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    delete:
      summary: Delete scenario
      description: Delete a scenario and its configuration file
      operationId: deleteScenario
      tags:
        - Scenarios
      responses:
        '200':
          description: Scenario deleted successfully
          content:
            application/json:
              schema:
                type: object
                required:
                  - message
                properties:
                  message:
                    type: string
                    example: Scenario 'testing' deleted successfully
        '404':
          description: Scenario not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /scenarios/active:
    get:
      summary: Get active scenario
      description: Retrieve the name of the currently active scenario
      operationId: getActiveScenario
      tags:
        - Active Scenario
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: object
                required:
                  - activeScenario
                  - lastUpdated
                properties:
                  activeScenario:
                    type: string
                    nullable: true
                    description: Name of active scenario or null
                  lastUpdated:
                    type: string
                    format: date-time
              examples:
                with-active:
                  summary: Active scenario present
                  value:
                    activeScenario: testing
                    lastUpdated: '2025-11-29T10:15:00.000Z'
                no-active:
                  summary: No active scenario
                  value:
                    activeScenario: null
                    lastUpdated: '2025-11-29T10:00:00.000Z'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  schemas:
    Scenario:
      type: object
      required:
        - name
        - endpointConfigurations
        - metadata
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 50
          pattern: '^[a-zA-Z0-9-]+$'
          description: Unique scenario identifier
          example: testing
        endpointConfigurations:
          type: array
          minItems: 1
          items:
            $ref: '#/components/schemas/EndpointConfiguration'
        metadata:
          $ref: '#/components/schemas/ScenarioMetadata'

    EndpointConfiguration:
      type: object
      required:
        - path
        - method
        - selectedMockFile
      properties:
        path:
          type: string
          minLength: 1
          pattern: '^/[a-zA-Z0-9{}\-_/]*$'
          description: Endpoint path
          example: /pet/status
        method:
          type: string
          enum:
            - GET
            - POST
            - PUT
            - DELETE
            - PATCH
          description: HTTP method
          example: GET
        selectedMockFile:
          type: string
          minLength: 1
          pattern: '^.*\.json$'
          description: Mock response filename
          example: success-200.json
        delayMillisecond:
          type: integer
          minimum: 0
          maximum: 60000
          default: 0
          description: Response delay in milliseconds
          example: 1000

    ScenarioMetadata:
      type: object
      required:
        - createdAt
        - lastModified
        - version
      properties:
        createdAt:
          type: string
          format: date-time
          description: Scenario creation timestamp
          example: '2025-11-29T10:00:00.000Z'
        lastModified:
          type: string
          format: date-time
          description: Last modification timestamp
          example: '2025-11-29T10:15:00.000Z'
        version:
          type: integer
          minimum: 1
          description: Scenario version number
          example: 2

    CreateScenarioRequest:
      type: object
      required:
        - name
        - endpointConfigurations
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 50
          pattern: '^[a-zA-Z0-9-]+$'
          example: testing
        endpointConfigurations:
          type: array
          minItems: 1
          items:
            $ref: '#/components/schemas/EndpointConfiguration'

    UpdateScenarioRequest:
      type: object
      required:
        - endpointConfigurations
      properties:
        endpointConfigurations:
          type: array
          minItems: 1
          items:
            $ref: '#/components/schemas/EndpointConfiguration'

    Error:
      type: object
      required:
        - error
      properties:
        error:
          type: string
          description: Error message
          example: Internal server error

    ValidationError:
      type: object
      required:
        - error
        - field
        - constraint
      properties:
        error:
          type: string
          example: Validation failed
        field:
          type: string
          description: Field that failed validation
          example: endpointConfigurations
        constraint:
          type: string
          description: Validation constraint that was violated
          example: Scenario must contain at least one endpoint configuration
